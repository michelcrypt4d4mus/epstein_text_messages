from os import devnull
from rich.console import Console

from epstein_files.output.rich import CONSOLE_KWARGS, highlighter, print_json
from epstein_files.util.env import args

HIGHLIGHT_COUNTS = {
    "0000072170": 1,
    "0001128723": 1,
    "0001144204": 3,
    "0001429764": 2,
    "0001607281": 1,
    "<REDACTED>": 1,
    "ADR": 3,
    "AG": 1,
    "AIPAC": 1,
    "AML": 37,
    "Acosta": 1,
    "Anti-Money Laundering": 1,
    "Ari Glass": 1,
    "Attachments:": 1,
    "Audrey Strauss": 1,
    "Austin": 1,
    "Austria": 1,
    "Bahamas": 3,
    "Bannon": 1,
    "Barr": 3,
    "Bear Stearns": 1,
    "Blackstone": 3,
    "Blair": 2,
    "Boothbay": 1,
    "Broidy": 1,
    "CEO": 17,
    "CIS": 1,
    "Cambridge": 4,
    "Cannabis": 2,
    "Chair Clayton": 4,
    "China": 2,
    "Chinese": 1,
    "Chris Dilorio": 26,
    "Christopher": 19,
    "Clayton": 10,
    "Coleman": 5,
    "Colorado": 2,
    "Credit Suisse": 1,
    "DB": 1,
    "DOJ": 7,
    "Date:": 1,
    "Deutsche Bank": 2,
    "Dilorio": 20,
    "DoJ": 4,
    "Donald": 1,
    "Dutch": 1,
    "EDGAR Filing": 1,
    "EUROPE": 2,
    "Epstein": 3,
    "FINCEN": 6,
    "FINRA": 68,
    "FINRA.org": 1,
    "FLORIDA": 1,
    "FOIA": 2,
    "Farkas": 2,
    "FinCEN": 3,
    "Florida": 3,
    "From:": 25,
    "German": 1,
    "Glenn": 1,
    "Greek": 2,
    "Hapoalim": 1,
    "Hillary Clinton": 1,
    "Honig": 5,
    "IRS": 5,
    "Israel": 2,
    "Israeli": 1,
    "JPM": 10,
    "Jared": 5,
    "Jay Clayton": 2,
    "Jersey City": 1,
    "Justin": 6,
    "Kushner": 4,
    "LAUNDERING": 2,
    "Leon Black": 1,
    "MSFT": 1,
    "Madoff": 10,
    "Merrill": 1,
    "Miami": 2,
    "Milken": 19,
    "Mnuchin": 1,
    "Mogilevich": 1,
    "Money Laundering": 1,
    "Money laundering": 3,
    "None": 43,
    "Obama": 1,
    "PA": 1,
    "Peirce": 1,
    "Puerto Rico": 1,
    "Putin": 1,
    "Rakishev": 2,
    "Russia": 2,
    "Russian": 8,
    "SBNY": 2,
    "SCOTUS": 1,
    "SDNY": 9,
    "SEC": 418,
    "SECURITIES AND EXCHANGE COMMISSION": 5,
    "SOUTHERN DISTRICT OF FLORIDA": 1,
    "SOUTHERN DISTRICT OF NEW YORK": 2,
    "San Juan": 1,
    "Schwarzman": 1,
    "Securities and Exchange Commission": 5,
    "Sent:": 20,
    "Spitzer": 2,
    "Subject:": 21,
    "Sull Crom": 6,
    "Sullivan Cromwell": 3,
    "Swiss": 8,
    "Switzerland": 1,
    "Texas": 1,
    "To:": 4,
    "Trump": 12,
    "U.S. Attorney": 2,
    "UBS": 13,
    "UBSS": 39,
    "UNITED STATES DISTRICT COURT": 2,
    "Ukrainian": 1,
    "WASHINGTON": 1,
    "WSJ": 1,
    "Washington": 3,
    "Wire Card": 2,
    "WireCa rd": 1,
    "anti-money laundering": 1,
    "fincen": 3,
    "finra": 1,
    "honigs": 1,
    "http://irmasdaq.com/static-files/6b1ca278-75f0-4259-9372-5b3351126a8b": 1,
    "http://www.teribuhl.com/2019/08/06/honigs-shell-factory-attorney-gregg-jaclin-barred-as-sec-lawm1": 1,
    "http://www.tribune242.com/news/2016/jan/13/bahamian-broker-25m-sanction/": 1,
    "https://find-and-update.company-information.service.gov.uk/company/03385409/officers": 1,
    "https://www.clearygottlieb.com/news-and-insights/news-listing/14-billion-merger-of-kcg-holdings-and-virtu-": 1,
    "https://www.fincen.gov/news/news-releases/fincen-fines-oppenheimer-co-inc-20-million-continued-anti-": 1,
    "https://www.finextra.com/pressarticle/49357/otkritie-capital-taps-sungard-for-automated-ruble-conversion": 1,
    "https://www.finra.org/media-center/news-releases/2013/finra-fines-three-firms-900000-inadequate-anti-": 1,
    "https://www.finra.org/sites/default/files/OHODecision/p182993": 1,
    "https://www.finra.org/sites/default/files/fda": 1,
    "https://www.fool.com/earnings/call-transcripts/2020/11/06/virtu-financial-inc-virt-q3-2020-earnings-call-tra/": 1,
    "https://www.lexology.com/library/detail.aspx?g=9e2b4e49-See2-48f6-b8c7-03d39d02b5ca": 1,
    "https://www.netelement.com/press-releases/release-content/1062906/4.XwRXEOWSnIV": 1,
    "https://www.pr.com/press-release/355247": 1,
    "https://www.sec.gov/Archives/edgaddata/1322587/000114420413065095/v361773": 1,
    "https://www.sec.gov/Archives/edgar/data/1344394/000114420413041432/0001144204-13-041432-index.htm": 1,
    "https://www.sec.gov/Archives/edgar/data/1344394/000135448814000425/cgfi": 1,
    "https://www.sec.gov/Archives/edgar/data/1429764/000114420419004046/0001144204-19-004046-index.htm": 1,
    "https://www.sec.gov/Archives/edgar/data/1569391/000119312517129844/d359346dex991.htm": 1,
    "https://www.sec.gov/Archives/edgar/data/1592386/000110465920122134/tm2034848d1": 1,
    "https://www.sec.gov/cgi-bi": 1,
    "https://www.sec.gov/cgi-bin/browse-edgar?": 4,
    "https://www.sec.gov/cgi-bin/browse-edgar?company=Apptech&owner=exclude&action=getcompany": 1,
    "https://www.sec.gov/files/468.pdf": 1,
    "https://www.sec.gov/litigation/admin/2015/33-9711.pdf": 1,
    "https://www.sec.gov/litigation/admin/34-46993.htm": 1,
    "https://www.sec.gov/litigation/complaints/2013/comp22683.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2016/comp-pr2016-86.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2018/comp-pr2018-259.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2019/comp24403.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2020/comp-pr2020-72.pdf": 1,
    "https://www.sec.gov/litigation/litreleases/2019/lr24403.htm": 1,
    "https://www.sec.gov/litigation/litreleases/2020/Ir24779.htm": 1,
    "https://www.sec.gov/news/statement/dissenting-statement-oppenheimer-inc.html": 1,
    "https://www.sec.govinews/press-release/2019-16": 1,
    "https://wwwpr.com/press-release/369649": 1,
    "laundering": 6,
    "money laundering": 59,
    "pa": 2,
    "sec.gov": 36,
    "summer": 1,
    "www.finra.org": 6
}

test_console = Console(file=open(devnull, "wt"), **CONSOLE_KWARGS)


def test_highlight_count(get_email):
    old_debug_arg = args.debug
    args.debug = True
    dilorio_email = get_email('EFTA00039828')
    test_console.print(dilorio_email)
    print_json('highlight counts', highlighter.highlight_counts)
    assert highlighter.highlight_counts == HIGHLIGHT_COUNTS
    args.debug = old_debug_arg
