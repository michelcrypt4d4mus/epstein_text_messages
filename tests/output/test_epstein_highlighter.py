from os import devnull
from rich.console import Console

from epstein_files.output.rich import CONSOLE_KWARGS, highlighter, print_json
from epstein_files.util.env import args

HIGHLIGHT_COUNTS = {
    "0000072170": 1,
    "0001128723": 1,
    "0001144204": 3,
    "0001429764": 2,
    "0001607281": 1,
    '05/12/16': 1,
    '11/8/2018': 1,
    '13:08:35': 1,
    '2012/34-6801': 1,
    '2015/33-9711': 1,
    '2019/08/06': 1,
    '2020/11/06': 1,
    '3-20-13': 2,
    '4204-13-0414': 1,
    '4204-19-0040': 2,
    '6/23/2020': 3,
    '6/30/2020': 1,
    '7/31/2017': 3,
    "<redacted>": 1,
    "acosta": 1,
    "adr": 3,
    "ag": 1,
    "aipac": 1,
    "aml": 37,
    "anti-money laundering": 2,
    "ari glass": 1,
    "attachments:": 1,
    "audrey strauss": 1,
    "austin": 1,
    "austria": 1,
    "bahamas": 3,
    "bank": 6,
    "banks": 4,
    "bannon": 1,
    "barr": 3,
    "bear stearns": 1,
    "blackstone": 3,
    "blair": 2,
    "boothbay": 1,
    "broidy": 1,
    "cambridge": 4,
    "cannabis": 2,
    "ceo": 17,
    "chair clayton": 4,
    "china": 2,
    "chinese": 1,
    "chris dilorio": 26,
    'christopher dilorio': 3,
    "christopher": 21,
    "cis": 1,
    "clayton": 10,
    "coleman": 5,
    "colorado": 2,
    "credit suisse": 1,
    "date:": 1,
    "db": 1,
    "deutsche bank": 2,
    "dilorio": 17,
    "doj": 11,
    "donald": 1,
    "dutch": 1,
    "edgar filing": 1,
    "epstein": 3,
    "europe": 2,
    "farkas": 2,
    "fincen": 12,
    "finra": 69,
    "finra.org": 1,
    "florida": 4,
    "foia": 2,
    "from:": 25,
    "german": 1,
    "glenn": 1,
    "greek": 2,
    "hapoalim": 1,
    "hillary clinton": 1,
    "honig": 5,
    "honigs": 1,
    "http://irmasdaq.com/static-files/6b1ca278-75f0-4259-9372-5b3351126a8b": 1,
    "http://www.teribuhl.com/2019/08/06/honigs-shell-factory-attorney-gregg-jaclin-barred-as-sec-lawm1": 1,
    "http://www.tribune242.com/news/2016/jan/13/bahamian-broker-25m-sanction/": 1,
    "https://find-and-update.company-information.service.gov.uk/company/03385409/officers": 1,
    "https://www.clearygottlieb.com/news-and-insights/news-listing/14-billion-merger-of-kcg-holdings-and-virtu-": 1,
    "https://www.fincen.gov/news/news-releases/fincen-fines-oppenheimer-co-inc-20-million-continued-anti-": 1,
    "https://www.finextra.com/pressarticle/49357/otkritie-capital-taps-sungard-for-automated-ruble-conversion": 1,
    "https://www.finra.org/media-center/news-releases/2013/finra-fines-three-firms-900000-inadequate-anti-": 1,
    "https://www.finra.org/sites/default/files/fda": 1,
    "https://www.finra.org/sites/default/files/ohodecision/p182993": 1,
    "https://www.fool.com/earnings/call-transcripts/2020/11/06/virtu-financial-inc-virt-q3-2020-earnings-call-tra/": 1,
    "https://www.lexology.com/library/detail.aspx?g=9e2b4e49-see2-48f6-b8c7-03d39d02b5ca": 1,
    "https://www.netelement.com/press-releases/release-content/1062906/4.xwrxeowsniv": 1,
    "https://www.pr.com/press-release/355247": 1,
    "https://www.sec.gov/archives/edgaddata/1322587/000114420413065095/v361773": 1,
    "https://www.sec.gov/archives/edgar/data/1344394/000114420413041432/0001144204-13-041432-index.htm": 1,
    "https://www.sec.gov/archives/edgar/data/1344394/000135448814000425/cgfi": 1,
    "https://www.sec.gov/archives/edgar/data/1429764/000114420419004046/0001144204-19-004046-index.htm": 1,
    "https://www.sec.gov/archives/edgar/data/1569391/000119312517129844/d359346dex991.htm": 1,
    "https://www.sec.gov/archives/edgar/data/1592386/000110465920122134/tm2034848d1": 1,
    "https://www.sec.gov/cgi-bi": 1,
    "https://www.sec.gov/cgi-bin/browse-edgar?": 4,
    "https://www.sec.gov/cgi-bin/browse-edgar?company=apptech&owner=exclude&action=getcompany": 1,
    "https://www.sec.gov/files/468.pdf": 1,
    "https://www.sec.gov/litigation/admin/2015/33-9711.pdf": 1,
    "https://www.sec.gov/litigation/admin/34-46993.htm": 1,
    "https://www.sec.gov/litigation/complaints/2013/comp22683.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2016/comp-pr2016-86.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2018/comp-pr2018-259.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2019/comp24403.pdf": 1,
    "https://www.sec.gov/litigation/complaints/2020/comp-pr2020-72.pdf": 1,
    "https://www.sec.gov/litigation/litreleases/2019/lr24403.htm": 1,
    "https://www.sec.gov/litigation/litreleases/2020/ir24779.htm": 1,
    "https://www.sec.gov/news/statement/dissenting-statement-oppenheimer-inc.html": 1,
    "https://www.sec.govinews/press-release/2019-16": 1,
    "https://wwwpr.com/press-release/369649": 1,
    "irs": 5,
    "israel": 2,
    "israeli": 1,
    "jared": 5,
    "jay clayton": 2,
    "jersey city": 1,
    "jpm": 10,
    "justin": 6,
    "kushner": 4,
    "laundering": 6,
    "leon black": 1,
    "madoff": 10,
    "merrill": 1,
    "miami": 2,
    "milken": 19,
    "mnuchin": 1,
    "mogilevich": 1,
    "money laundering": 63,
    "money-laundering": 2,
    "msft": 1,
    "none": 43,
    "obama": 1,
    "pa": 3,
    "peirce": 1,
    "puerto rico": 1,
    "putin": 1,
    "rakishev": 2,
    "russia": 2,
    "russian": 8,
    "san juan": 1,
    "sbny": 2,
    "schwarzman": 1,
    "scotus": 1,
    "sdny": 9,
    "sec": 418,
    "sec.gov": 36,
    "securities and exchange commission": 10,
    "sent:": 20,
    "southern district of florida": 1,
    "southern district of new york": 2,
    "spitzer": 2,
    "subject:": 21,
    "sull crom": 6,
    "sullivan cromwell": 3,
    "summer": 1,
    "swiss": 8,
    "switzerland": 1,
    "texas": 1,
    "to:": 4,
    "trump": 12,
    "u.s. attorney": 2,
    "ubs": 13,
    "ubss": 39,
    "ukrainian": 1,
    "united states district court": 2,
    "washington": 4,
    "wire card": 2,
    "wireca rd": 1,
    "wsj": 1,
    "www.finra.org": 6
}

test_console = Console(file=open(devnull, "wt"), **CONSOLE_KWARGS)


def test_highlight_count(get_email):
    old_stats_arg = args.stats
    args.stats = True
    dilorio_email = get_email('EFTA00039828')
    test_console.print(dilorio_email)
    print_json('highlight counts', highlighter.highlight_counts)
    assert highlighter.highlight_counts == HIGHLIGHT_COUNTS
    args.stats = old_stats_arg
